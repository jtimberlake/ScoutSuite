{
  "description": "EC2 Instance with DynamoDB Management Permissions",
  "rationale": "Compute elements (EC2 instances, ECS containers, Lambda functions) must not have access to managerial actions such as creating/deleting tables, altering the backup settings, or altering the encryption properties of a table.",
  "references": [
    "https://zendesk.atlassian.net/wiki/spaces/SEC/pages/771261565/AWS+Service+Hardening+Guidelines#AWSServiceHardeningGuidelines-DynamoDB"
  ],
  "dashboard_name": "Instance Profiles",
  "remediation": "",
  "path": "iam.roles.id.instance_profiles.id",
  "conditions": [
    "and",
    [
      "iam.roles.id.instance_profiles",
      "containAtLeastOneOf",
      "_GET_VALUE_AT(ec2.regions.id.vpcs.id.instances.id.iam_instance_profile_arn)"
    ],
    [
      "and",
      [
        "iam.roles.id.inline_policies.id.PolicyDocument.Statement.id.Action",
        "containAtLeastOneOf",
        [
          "dynamodb:CreateBackup",
          "dynamodb:CreateGlobalTable",
          "dynamodb:CreateTable",
          "dynamodb:DeleteBackup",
          "dynamodb:DeleteTable",
          "dynamodb:RestoreTableFromBackup",
          "dynamodb:RestoreTableToPointInTime",
          "dynamodb:TagResource",
          "dynamodb:UntagResource",
          "dynamodb:UpdateTable",
          "dynamodb:UpdateTimeToLive",
          "dax:*"
        ]
      ],
      [
        "iam.roles.id.inline_policies.id.PolicyDocument.Statement.id.Effect",
        "equal",
        "Allow"
      ]
    ]
  ]
}
